FROM nginx

ARG NGINX_CONF_PATH
ARG SSL_CERTIFICATE_FILENAME_ARG
ARG SSL_CERTIFICATE_KEY_FILENAME_ARG
ARG DOMAIN_NAME_ARG

ENV DIR_NGINX_CONF=/usr/src/app/nginx/conf.d/
ENV NGINX_CONF_INNER=${DIR_NGINX_CONF}nginx.conf

RUN mkdir -p $DIR_NGINX_CONF

COPY ${NGINX_CONF_PATH} ${NGINX_CONF_INNER}

RUN envsubst '$SSL_CERTIFICATE_FILENAME_ARG,$SSL_CERTIFICATE_KEY_FILENAME_ARG,$DOMAIN_NAME_ARG' < ${NGINX_CONF_INNER} > /etc/nginx/conf.d/default.conf
